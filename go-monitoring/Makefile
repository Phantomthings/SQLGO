.PHONY: help build run clean test deps build-prod

help: ## Affiche l'aide
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-15s\033[0m %s\n", $$1, $$2}'

deps: ## TÃ©lÃ©charge les dÃ©pendances
	@echo "ğŸ“¦ TÃ©lÃ©chargement des dÃ©pendances..."
	go mod download
	go mod tidy

build: deps ## Compile l'application
	@echo "ğŸ”¨ Compilation de l'application..."
	go build -o bin/monitoring cmd/server/main.go
	@echo "âœ… Binaire crÃ©Ã© : bin/monitoring"

build-prod: deps ## Compile pour production (optimisÃ©)
	@echo "ğŸ”¨ Compilation pour production..."
	CGO_ENABLED=0 go build -ldflags="-s -w" -o bin/monitoring cmd/server/main.go
	@echo "âœ… Binaire optimisÃ© crÃ©Ã© : bin/monitoring"

run: build ## Lance le serveur
	@echo "ğŸš€ DÃ©marrage du serveur..."
	./bin/monitoring

dev: ## Lance en mode dÃ©veloppement (avec auto-reload)
	@echo "ğŸ”§ Mode dÃ©veloppement..."
	go run cmd/server/main.go

clean: ## Nettoie les fichiers compilÃ©s
	@echo "ğŸ§¹ Nettoyage..."
	rm -rf bin/
	go clean

test: ## Lance les tests
	@echo "ğŸ§ª Lancement des tests..."
	go test -v ./...

fmt: ## Formate le code
	@echo "âœ¨ Formatage du code..."
	go fmt ./...

lint: ## VÃ©rifie le code
	@echo "ğŸ” VÃ©rification du code..."
	go vet ./...

docker-build: ## Construit l'image Docker
	@echo "ğŸ³ Construction de l'image Docker..."
	docker build -t monitoring-bornes:latest .

docker-run: docker-build ## Lance le container Docker
	@echo "ğŸ³ Lancement du container..."
	docker run -p 8080:8080 monitoring-bornes:latest
